<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kidney Disease Classifier</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f5f7fb;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .header {
        background: #1b2d6b;
        color: white;
        padding: 25px 0;
        text-align: center;
        border-radius: 0 0 20px 20px;
      }
      .card {
        border-radius: 15px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
      }
      .image-part {
        height: 300px;
        border-radius: 15px;
        border: 1px solid #ddd;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #fff;
        overflow: hidden;
      }
      .image-part img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }
      .res-part {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        min-height: 140px;
      }
      .btn-custom {
        border-radius: 30px;
        padding: 10px 25px;
        font-weight: 600;
      }
      .result-title {
        color: #1b2d6b;
        font-weight: 600;
      }
      #loading {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.85);
        display: none;
        z-index: 9999;
      }
      .loader {
        width: 60px;
        height: 60px;
        border: 8px solid #eee;
        border-top: 8px solid #1b2d6b;
        border-radius: 50%;
        animation: spin 1.2s linear infinite;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      @keyframes spin {
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div class="header">
      <h1>Kidney Disease Classifier</h1>
      <p>AI-powered CT scan classification</p>
    </div>

    <div class="container my-5">
      <div class="row g-4">
        <!-- Upload Card -->
        <div class="col-md-6">
          <div class="card p-4">
            <h4 class="text-center mb-3">Upload Image</h4>

            <div class="image-part mb-2">
              <img id="photo" style="display: none" />
            </div>

            <!-- Filename display -->
            <p
              id="fileName"
              class="text-center text-muted mb-3"
              style="display: none"
            ></p>

            <div class="text-center">
              <button class="btn btn-primary btn-custom me-2" id="uload">
                Upload
              </button>
              <button class="btn btn-success btn-custom" id="send">
                Predict
              </button>
              <input type="file" id="fileinput" hidden />
              <input type="hidden" id="url" value="/predict" />
            </div>
          </div>
        </div>

        <!-- Result Card -->
        <div class="col-md-6">
          <div class="card p-4">
            <h4 class="text-center mb-3">Prediction Result</h4>
            <div class="res-part text-center">
              <div class="jsonRes text-muted">
                Upload an image to see prediction
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="loading"><div class="loader"></div></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
      let base_data = "";
      let uploadedFileName = "";

      // Upload image
      $("#fileinput").change(function () {
        if (this.files && this.files[0]) {
          const file = this.files[0];
          uploadedFileName = file.name;

          const reader = new FileReader();
          reader.onload = function (e) {
            const img = new Image();
            img.onload = function () {
              const canvas = document.createElement("canvas");
              canvas.width = img.width;
              canvas.height = img.height;
              canvas.getContext("2d").drawImage(img, 0, 0);
              base_data = canvas
                .toDataURL("image/jpeg", 1.0)
                .replace(/^data:image.+;base64,/, "");
            };
            img.src = e.target.result;

            $("#photo").attr("src", e.target.result).show();
            $("#fileName")
              .text("Uploaded File: " + uploadedFileName)
              .show();
          };
          reader.readAsDataURL(file);
        }
      });

      // Trigger file input
      $("#uload").click(() => $("#fileinput").click());

      // Predict
      $("#send").click(function () {
        if (!base_data) {
          alert("Please upload an image first!");
          return;
        }

        $("#loading").show();

        $.ajax({
          url: $("#url").val(),
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify({ image: base_data }),
          success: function (res) {
            $("#loading").hide();

            $(".jsonRes").html(`
                <p class="result-title">Provided Image</p>
                <p><b>${uploadedFileName}</b></p>
                <hr>
                <p class="result-title">Predicted Class</p>
                <h3>${res.class}</h3>
                <p>Confidence: ${(res.confidence * 100).toFixed(2)}%</p>
            `);
          },
          error: function () {
            $("#loading").hide();
            alert("Prediction failed. Check backend.");
          },
        });
      });
    </script>
  </body>
</html>
